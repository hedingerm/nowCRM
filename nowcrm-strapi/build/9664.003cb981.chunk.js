"use strict";(self.webpackChunkstrapi_app=self.webpackChunkstrapi_app||[]).push([[9664],{7745:(ts,p,s)=>{s.d(p,{u:()=>M});var t=s(16592),d=s(47249),y=s(99532),E=s(9732);const M=(D={},L)=>{const{locale:R}=(0,y.A)(),P=(0,d.QM)(R,{sensitivity:"base"}),{data:v,error:B,isError:S,isLoading:u,refetch:W}=(0,E.z)(D,L);return{roles:t.useMemo(()=>[...v??[]].sort((Z,r)=>P.compare(Z.name,r.name)),[v,P]),error:B,isError:S,isLoading:u,refetch:W}}},19273:(ts,p,s)=>{s.d(p,{F:()=>R});var t=s(15724),d=s(16592),y=s(68574),E=s(33e3),M=s(47249),D=s(35582),L=s(99532);const R=({displayedFilters:P})=>{const[v,B]=d.useState(!1),{formatMessage:S}=(0,L.A)(),u=d.useRef(null),W=()=>{B(z=>!z)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(y.a,{paddingTop:1,paddingBottom:1,children:[(0,t.jsx)(E.$,{variant:"tertiary",ref:u,startIcon:(0,t.jsx)(D.A,{}),onClick:W,size:"S",children:S({id:"app.utils.filters",defaultMessage:"Filters"})}),v&&(0,t.jsx)(M.LC,{displayedFilters:P,isVisible:v,onToggle:W,source:u})]}),(0,t.jsx)(M.cZ,{filtersSchema:P})]})}},23136:(ts,p,s)=>{s.d(p,{M:()=>S,S:()=>u,a:()=>B});var t=s(15724),d=s(99532),y=s(9732),E=s(5694),M=s(2035),D=s(47249),L=s(79315),R=s(99157),P=s(14992),v=s(7745);const B=({children:r,target:O})=>{const F=(0,D.hN)(),{formatMessage:V}=(0,d.A)(),{copy:f}=(0,D.iD)(),e=V({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),T=async()=>{await f(O)&&F({type:"info",message:{id:"notification.link-copied"}})};return(0,t.jsx)(D.bQ,{endAction:(0,t.jsx)(E.K,{label:e,noBorder:!0,icon:(0,t.jsx)(L.A,{}),onClick:T}),title:O,titleEllipsis:!0,subtitle:r,icon:(0,t.jsx)("span",{style:{fontSize:32},children:"\u2709\uFE0F"}),iconBackground:"neutral100"})},S=({registrationToken:r})=>{const{formatMessage:O}=(0,d.A)(),F=`${window.location.origin}${(0,y.K)()}/auth/register?registrationToken=${r}`;return(0,t.jsx)(B,{target:F,children:O({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})})},u=({disabled:r,error:O,onChange:F,value:V})=>{const{isLoading:f,roles:e}=(0,v.u)(),{formatMessage:T}=(0,d.A)(),N=O?T({id:O,defaultMessage:O}):"",q=T({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),_=T({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),es=T({id:"app.components.Select.placeholder",defaultMessage:"Select"});return(0,t.jsx)(M.KF,{id:"roles",disabled:r,error:N,hint:_,label:q,name:"roles",onChange:g=>{F({target:{name:"roles",value:g}})},placeholder:es,startIcon:f?(0,t.jsx)(Z,{}):void 0,value:V.map(g=>g.toString()),withTags:!0,required:!0,children:e.map(g=>(0,t.jsx)(M.fe,{value:g.id.toString(),children:T({id:`global.${g.code}`,defaultMessage:g.name})},g.id))})},W=(0,P.i7)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,z=P.Ay.div`
  animation: ${W} 2s infinite linear;
`,Z=()=>(0,t.jsx)(z,{children:(0,t.jsx)(R.A,{})})},39664:(ts,p,s)=>{s.d(p,{ProtectedListPage:()=>fs,e:()=>ls});var t=s(15724),d=s(16592),y=s(51336),E=s(68574),M=s(33e3),D=s(9704),L=s(78789),R=s(5694),P=s(34146),v=s(75715),B=s(21087),S=s(75726),u=s(88174),W=s(47107),z=s(8677),Z=s(64936),r=s(90886),O=s(50622),F=s(20480),V=s(63962),f=s(96352),e=s(47249),T=s(71430),N=s(99532),q=s(67691),_=s(9732),es=s(19273),g=s(21499),_s=s(96935),ds=s(74082),Es=s(10549),Ms=s(69646),ms=s(59652),b=s(70991),is=s(23136),as=s(70679),Ts=s(94174),Is=s(52211),Us=s(11164),Rs=s(43274),Bs=s(80265),us=s(4223),Ws=s(83670),xs=s(57036),Ks=s(18337),js=s(49079),ps=s(61622),ys=s(11338),Ss=s(24172),Fs=s(54150),Vs=s(68216),Ns=s(55758),$s=s(85715),zs=s(61951),Ys=s(50984),Gs=s(97769),Hs=s(92082),Qs=s(12958),Xs=s(16439),Js=s(34215),Zs=s(34374),bs=s(81121),ks=s(32828),ws=s(45298),qs=s(75830),st=s(36239),tt=s(87295),et=s(53377),at=s(42605),nt=s(3342),it=s(73518),ot=s(65737),lt=s(61184),rt=s(58668),_t=s(36901),dt=s(50840),Et=s(13123),Mt=s(7851),mt=s(7745),ct=s(71575),Dt=s(9389);const cs=({onClick:a})=>{const{formatMessage:i}=(0,N.A)();return(0,t.jsx)(M.$,{onClick:a,startIcon:(0,t.jsx)(g.A,{}),size:"S",children:i({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"})})},Ds=({onToggle:a})=>{const[i,x]=d.useState("create"),[Y,G]=d.useState(""),{formatMessage:m}=(0,N.A)(),A=(0,e.hN)(),{lockApp:H,unlockApp:I}=(0,e.MA)(),{_unstableFormatAPIError:Q,_unstableFormatValidationErrors:K}=(0,e.wq)(),n=(0,_.p)(Ps,async()=>(await s.e(7480).then(s.bind(s,37480))).ROLE_LAYOUT,{combine(o,U){return[...o,...U]},defaultValue:[]}),$=(0,_.p)(os,async()=>(await s.e(7480).then(s.bind(s,37480))).FORM_INITIAL_VALUES,{combine(o,U){return{...o,...U}},defaultValue:os}),h=(0,_.p)(is.M,async()=>(await s.e(5649).then(s.bind(s,25649))).MagicLinkEE),[X]=(0,_.H)(),j=m({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}),k=async(o,{setErrors:U})=>{H();const c=await X({...o,roles:o.roles??[]});"data"in c?c.data.registrationToken?(G(c.data.registrationToken),ss()):A({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}):(A({type:"warning",message:Q(c.error)}),(0,_.x)(c.error)&&c.error.name==="ValidationError"&&U(K(c.error))),I()},ss=()=>{l?x(l):a()},{buttonSubmitLabel:w,isDisabled:J,next:l}=As[i];return h?(0,t.jsxs)(u.k,{onClose:a,labelledBy:"title",children:[(0,t.jsx)(W.r,{children:(0,t.jsx)(Es.B,{label:j,children:(0,t.jsx)(Ms.m,{isCurrent:!0,children:j})})}),(0,t.jsx)(ms.l1,{enableReinitialize:!0,initialValues:$??{},onSubmit:k,validationSchema:gs,validateOnChange:!1,children:({errors:o,handleChange:U,values:c,isSubmitting:rs})=>(0,t.jsxs)(e.lV,{children:[(0,t.jsx)(Z.c,{children:(0,t.jsxs)(r.s,{direction:"column",alignItems:"stretch",gap:6,children:[i!=="create"&&(0,t.jsx)(h,{registrationToken:Y}),(0,t.jsxs)(E.a,{children:[(0,t.jsx)(f.o,{variant:"beta",as:"h2",children:m({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"User details"})}),(0,t.jsx)(E.a,{paddingTop:4,children:(0,t.jsx)(r.s,{direction:"column",alignItems:"stretch",gap:1,children:(0,t.jsx)(D.x,{gap:5,children:Os.map(ns=>ns.map(C=>(0,t.jsx)(L.E,{...C.size,children:(0,t.jsx)(e.ah,{...C,disabled:J,error:o[C.name],onChange:U,value:c[C.name]})},C.name)))})})})]}),(0,t.jsxs)(E.a,{children:[(0,t.jsx)(f.o,{variant:"beta",as:"h2",children:m({id:"global.roles",defaultMessage:"User's role"})}),(0,t.jsx)(E.a,{paddingTop:4,children:(0,t.jsxs)(D.x,{gap:5,children:[(0,t.jsx)(L.E,{col:6,xs:12,children:(0,t.jsx)(is.S,{disabled:J,error:o.roles,onChange:U,value:c.roles??[]})}),n.map(ns=>ns.map(C=>(0,t.jsx)(L.E,{...C.size,children:(0,t.jsx)(e.ah,{...C,disabled:J,onChange:U,value:c[C.name]})},C.name)))]})})]})]})}),(0,t.jsx)(z.j,{startActions:(0,t.jsx)(M.$,{variant:"tertiary",onClick:a,type:"button",children:m({id:"app.components.Button.cancel",defaultMessage:"Cancel"})}),endActions:i==="create"?(0,t.jsx)(M.$,{type:"submit",loading:rs,children:m(w)}):(0,t.jsx)(M.$,{type:"button",loading:rs,onClick:a,children:m(w)})})]})})]}):null},os={firstname:"",lastname:"",email:"",roles:[]},Ps=[],Os=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0}]],gs=b.Ik().shape({firstname:b.Yj().trim().required(e.iW.required),lastname:b.Yj(),email:b.Yj().email(e.iW.email).required(e.iW.required),roles:b.YO().min(1,e.iW.required).required(e.iW.required)}),As={create:{buttonSubmitLabel:{id:"app.containers.Users.ModalForm.footer.button-success",defaultMessage:"Invite user"},isDisabled:!1,next:"magic-link"},"magic-link":{buttonSubmitLabel:{id:"global.finish",defaultMessage:"Finish"},isDisabled:!0,next:null}},hs=({canDelete:a,headers:i=[],entriesToDelete:x=[],onClickDelete:Y,onSelectRow:G,withMainAction:m,withBulkActions:A,rows:H=[]})=>{const{push:I,location:{pathname:Q}}=(0,q.W6)(),{formatMessage:K}=(0,N.A)();return(0,t.jsx)(O.N,{children:H.map(n=>{const $=x.findIndex(h=>h===n.id)!==-1;return(0,t.jsxs)(F.Tr,{...(0,e.qM)({fn:()=>I(`${Q}/${n.id}`),condition:A}),children:[m&&(0,t.jsx)(V.Td,{...e.dG,children:(0,t.jsx)(y.J,{"aria-label":K({id:"app.component.table.select.one-entry",defaultMessage:"Select {target}"},{target:(0,as.g)(n?.firstname??"",n.lastname)}),checked:$,onChange:()=>{G&&G({name:n.id,value:!$})}})}),i.map(({key:h,cellFormatter:X,name:j,...k})=>(0,t.jsx)(V.Td,{children:typeof X=="function"?X(n,{key:h,name:j,formatMessage:K,...k}):(0,t.jsx)(f.o,{textColor:"neutral800",children:n[j]||"-"})},h)),A&&(0,t.jsx)(V.Td,{children:(0,t.jsxs)(r.s,{justifyContent:"end",children:[(0,t.jsx)(R.K,{onClick:()=>I(`${Q}/${n.id}`),label:K({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:(0,as.g)(n.firstname??"",n.lastname)}),noBorder:!0,icon:(0,t.jsx)(_s.A,{})}),a&&(0,t.jsx)(E.a,{paddingLeft:1,...e.dG,children:(0,t.jsx)(R.K,{onClick:()=>{Y&&Y(n.id)},label:K({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:(0,as.g)(n.firstname??"",n.lastname)}),noBorder:!0,icon:(0,t.jsx)(ds.A,{})})})]})})]},n.id)})})},ls=()=>{const{_unstableFormatAPIError:a}=(0,e.wq)(),[i,x]=d.useState(!1),Y=(0,_.j)(l=>l.admin_app.permissions),{allowedActions:{canCreate:G,canDelete:m,canRead:A}}=(0,e.ec)(Y.settings?.users),H=(0,e.hN)(),{formatMessage:I}=(0,N.A)(),{search:Q}=(0,q.zy)();(0,e.L4)();const{data:K,isError:n,isLoading:$}=(0,_.k)(T.parse(Q,{ignoreQueryPrefix:!0}),{skip:!A}),{pagination:h,users:X}=K??{},j=(0,_.p)(cs,async()=>(await s.e(1622).then(s.bind(s,41622))).CreateActionEE),k=Cs.map(l=>({...l,metadatas:{...l.metadatas,label:I(l.metadatas.label)}})),ss=I({id:"global.users",defaultMessage:"Users"}),w=()=>{x(l=>!l)},[J]=(0,_.J)();return j?(0,t.jsxs)(S.g,{"aria-busy":$,children:[(0,t.jsx)(e.x7,{name:"Users"}),(0,t.jsx)(B.Q,{primaryAction:G&&(0,t.jsx)(j,{onClick:w}),title:ss,subtitle:I({id:"Settings.permissions.users.listview.header.subtitle",defaultMessage:"All the users who have access to the Strapi admin panel"})}),A&&(0,t.jsx)(P.B,{startActions:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.q7,{label:I({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:ss})}),(0,t.jsx)(es.F,{displayedFilters:Ls})]})}),(0,t.jsxs)(v.s,{children:[!A&&(0,t.jsx)(e.UW,{}),n&&(0,t.jsx)("div",{children:"TODO: An error occurred"}),A&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.Ee,{contentType:"Users",isLoading:$,onConfirmDeleteAll:async l=>{const o=await J({ids:l});"error"in o&&H({type:"warning",message:a(o.error)})},onConfirmDelete:async l=>{const o=await J({ids:[l]});"error"in o&&H({type:"warning",message:a(o.error)})},headers:k,rows:X,withBulkActions:!0,withMainAction:m,children:(0,t.jsx)(hs,{canDelete:m})}),h&&(0,t.jsx)(E.a,{paddingTop:4,children:(0,t.jsxs)(r.s,{alignItems:"flex-end",justifyContent:"space-between",children:[(0,t.jsx)(e._u,{}),(0,t.jsx)(e.W7,{pagination:h})]})})]})]}),i&&(0,t.jsx)(Ds,{onToggle:w})]}):null},Cs=[{name:"firstname",key:"firstname",metadatas:{label:{id:"Settings.permissions.users.firstname",defaultMessage:"Firstname"},sortable:!0}},{name:"lastname",key:"lastname",metadatas:{label:{id:"Settings.permissions.users.lastname",defaultMessage:"Lastname"},sortable:!0}},{key:"email",name:"email",metadatas:{label:{id:"Settings.permissions.users.email",defaultMessage:"Email"},sortable:!0}},{key:"roles",name:"roles",metadatas:{label:{id:"Settings.permissions.users.roles",defaultMessage:"Roles"},sortable:!1},cellFormatter({roles:a},{formatMessage:i}){return(0,t.jsx)(f.o,{textColor:"neutral800",children:a.map(x=>i({id:`Settings.permissions.users.${x.code}`,defaultMessage:x.name})).join(`,
`)})}},{key:"username",name:"username",metadatas:{label:{id:"Settings.permissions.users.username",defaultMessage:"Username"},sortable:!0}},{key:"isActive",name:"isActive",metadatas:{label:{id:"Settings.permissions.users.user-status",defaultMessage:"User status"},sortable:!1},cellFormatter({isActive:a},{formatMessage:i}){return(0,t.jsxs)(r.s,{children:[(0,t.jsx)(e.nW,{variant:a?"success":"danger"}),(0,t.jsx)(f.o,{textColor:"neutral800",children:i({id:a?"Settings.permissions.users.active":"Settings.permissions.users.inactive",defaultMessage:a?"Active":"Inactive"})})]})}}],Ls=[{name:"firstname",metadatas:{label:"Firstname"},fieldSchema:{type:"string"}},{name:"lastname",metadatas:{label:"Lastname"},fieldSchema:{type:"string"}},{name:"email",metadatas:{label:"Email"},fieldSchema:{type:"email"}},{name:"username",metadatas:{label:"Username"},fieldSchema:{type:"string"}},{name:"isActive",metadatas:{label:"Active user"},fieldSchema:{type:"boolean"}}],vs=()=>{const a=(0,_.p)(ls,async()=>(await s.e(8661).then(s.bind(s,48661))).UserListPageEE);return a?(0,t.jsx)(a,{}):null},fs=()=>{const a=(0,_.j)(i=>i.admin_app.permissions.settings?.users.main);return(0,t.jsx)(e.kz,{permissions:a,children:(0,t.jsx)(vs,{})})}}}]);
