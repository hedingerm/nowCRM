"use strict";(self.webpackChunkstrapi_app=self.webpackChunkstrapi_app||[]).push([[8705],{21753:(Z,L,t)=>{t.d(L,{u:()=>v});var e=t(9732);const f=e.n.injectEndpoints({endpoints:E=>({getWebhooks:E.query({query:a=>({url:`/admin/webhooks/${a?.id??""}`,method:"GET"}),transformResponse:a=>Array.isArray(a.data)?a.data:[a.data],providesTags:(a,h,M)=>typeof M=="object"&&"id"in M?[{type:"Webhook",id:M.id}]:[...a?.map(({id:b})=>({type:"Webhook",id:b}))??[],{type:"Webhook",id:"LIST"}]}),createWebhook:E.mutation({query:a=>({url:"/admin/webhooks",method:"POST",data:a}),transformResponse:a=>a.data,invalidatesTags:[{type:"Webhook",id:"LIST"}]}),updateWebhook:E.mutation({query:({id:a,...h})=>({url:`/admin/webhooks/${a}`,method:"PUT",data:h}),transformResponse:a=>a.data,invalidatesTags:(a,h,{id:M})=>[{type:"Webhook",id:M}]}),triggerWebhook:E.mutation({query:a=>({url:`/admin/webhooks/${a}/trigger`,method:"POST"}),transformResponse:a=>a.data}),deleteManyWebhooks:E.mutation({query:a=>({url:"/admin/webhooks/batch-delete",method:"POST",data:a}),transformResponse:a=>a.data,invalidatesTags:(a,h,{ids:M})=>M.map(b=>({type:"Webhook",id:b}))})}),overrideExisting:!1}),{useGetWebhooksQuery:U,useCreateWebhookMutation:C,useUpdateWebhookMutation:k,useTriggerWebhookMutation:B,useDeleteManyWebhooksMutation:K}=f,v=(E=void 0,a)=>{const{data:h,isLoading:M,error:b}=U(E,a),[w,{error:O}]=C(),[V,{error:T}]=k(),[F]=B(),[G]=K();return{webhooks:h,isLoading:M,error:b||O||T,createWebhook:w,updateWebhook:V,triggerWebhook:F,deleteManyWebhooks:G}}},38119:(Z,L,t)=>{t.d(L,{u:()=>K});var e=t(16592),f=t(47249),U=t(9732);const C=U.n.injectEndpoints({endpoints:v=>({getComponents:v.query({query:()=>({url:"/content-manager/components",method:"GET"}),transformResponse:E=>E.data}),getContentTypes:v.query({query:()=>({url:"/content-manager/content-types",method:"GET"}),transformResponse:E=>E.data})}),overrideExisting:!1}),{useGetComponentsQuery:k,useGetContentTypesQuery:B}=C;function K(){const{_unstableFormatAPIError:v}=(0,f.wq)(),E=(0,f.hN)(),a=k(),h=B();e.useEffect(()=>{h.error&&E({type:"warning",message:v(h.error)})},[h.error,v,E]),e.useEffect(()=>{a.error&&E({type:"warning",message:v(a.error)})},[a.error,v,E]);const M=a.isLoading||h.isLoading,b=e.useMemo(()=>(h?.data??[]).filter(O=>O.kind==="collectionType"&&O.isDisplayed),[h?.data]),w=e.useMemo(()=>(h?.data??[]).filter(O=>O.kind!=="collectionType"&&O.isDisplayed),[h?.data]);return{isLoading:M,components:e.useMemo(()=>a?.data??[],[a?.data]),collectionTypes:b,singleTypes:w}}},98705:(Z,L,t)=>{t.d(L,{E:()=>Y,a:()=>H,b:()=>Ue});var e=t(15724),f=t(16592),U=t(51336),C=t(68574),k=t(33e3),B=t(64014),K=t(5178),v=t(35609),E=t(22920),a=t(9704),h=t(78789),M=t(75715),b=t(21087),w=t(80885),O=t(75726),V=t(41115),T=t(90232),F=t(58506),G=t(91140),J=t(63638),p=t(90886),de=t(27622),z=t(44466),D=t(96352),le=t(56198),W=t(47249),ce=t(39648),q=t(67691),$=t(9732),ee=t(38119),ge=t(70679),he=t(90087),ue=t(50096),se=t(25164),te=t(25308),_e=t(99157),Ee=t(93302),me=t(67192),P=t(59652),I=t(99532),A=t(70991),pe=t(49375),X=t(14992),fe=t(21753);const[Me,ne]=(0,pe.q)("WebhookEvent"),xe=({children:s})=>{const{formatMessage:n}=(0,I.A)(),{collectionTypes:r,isLoading:c}=(0,ee.u)(),o=f.useMemo(()=>r.some(i=>i.options?.draftAndPublish===!0),[r]),g=n({id:"Settings.webhooks.form.events",defaultMessage:"Events"});return(0,e.jsx)(Me,{isDraftAndPublish:o,children:(0,e.jsxs)(p.s,{direction:"column",alignItems:"stretch",gap:1,children:[(0,e.jsx)(E.d,{"aria-hidden":!0,children:g}),c&&(0,e.jsx)(w.a,{children:n({id:"Settings.webhooks.events.isLoading",defaultMessage:"Events loading"})}),(0,e.jsx)(ye,{"aria-label":g,children:s})]})})},ye=(0,X.Ay)(V.X)`
  tbody tr:nth-child(odd) {
    background: ${({theme:s})=>s.colors.neutral100};
  }

  thead th span {
    color: ${({theme:s})=>s.colors.neutral500};
  }

  td,
  th {
    padding-block-start: ${({theme:s})=>s.spaces[3]};
    padding-block-end: ${({theme:s})=>s.spaces[3]};
    width: 10%;
    vertical-align: middle;
    text-align: center;
  }

  tbody tr td:first-child {
    /**
     * Add padding to the start of the first column to avoid the checkbox appearing
     * too close to the edge of the table
     */
    padding-inline-start: ${({theme:s})=>s.spaces[2]};
  }
`,je=s=>{const n=[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"}];return s&&(n.push({id:"app.utils.publish",defaultMessage:"Publish"}),n.push({id:"app.utils.unpublish",defaultMessage:"Unpublish"})),n},ve=({getHeaders:s=je})=>{const{isDraftAndPublish:n}=ne("Headers"),{formatMessage:r}=(0,I.A)(),c=s(n);return(0,e.jsx)(F.r,{children:(0,e.jsxs)(J.N,{children:[(0,e.jsx)(T.e,{children:(0,e.jsx)(le.s,{children:r({id:"Settings.webhooks.event.select",defaultMessage:"Select event"})})}),c.map(o=>["app.utils.publish","app.utils.unpublish"].includes(o?.id??"")?(0,e.jsx)(T.e,{title:r({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"}),children:(0,e.jsx)(D.o,{variant:"sigma",textColor:"neutral600",children:r(o)})},o.id):(0,e.jsx)(T.e,{children:(0,e.jsx)(D.o,{variant:"sigma",textColor:"neutral600",children:r(o)})},o.id))]})})},Pe=({providedEvents:s})=>{const{isDraftAndPublish:n}=ne("Body"),r=s||be(n),{values:c,handleChange:o}=(0,P.j7)(),g="events",i=c.events,m=[],x=i.reduce((d,l)=>{const _=l.split(".")[0];return d[_]||(d[_]=[]),d[_].push(l),d},{}),u=({target:{name:d,value:l}})=>{const _=new Set(i);l?_.add(d):_.delete(d),o({target:{name:g,value:Array.from(_)}})},y=({target:{name:d,value:l}})=>{const _=new Set(i);l?r[d].forEach(R=>{m.includes(R)||_.add(R)}):r[d].forEach(R=>_.delete(R)),o({target:{name:g,value:Array.from(_)}})};return(0,e.jsx)(G.f,{children:Object.entries(r).map(([d,l])=>(0,e.jsx)(re,{disabledEvents:m,name:d,events:l,inputValue:x[d],handleSelect:u,handleSelectAll:y},d))})},be=s=>{const n=["entry.create","entry.update","entry.delete"];return s&&n.push("entry.publish","entry.unpublish"),{entry:n,media:["media.create","media.update","media.delete"]}},re=({disabledEvents:s=[],name:n,events:r=[],inputValue:c=[],handleSelect:o,handleSelectAll:g})=>{const{formatMessage:i}=(0,I.A)(),m=r.filter(l=>!s.includes(l)),x=c.length>0,u=c.length===m.length,y=({target:{name:l}})=>{g({target:{name:l,value:!u}})},d=5;return(0,e.jsxs)(J.N,{children:[(0,e.jsx)(T.N,{children:(0,e.jsx)(B.S,{indeterminate:x&&!u,"aria-label":i({id:"global.select-all-entries",defaultMessage:"Select all entries"}),name:n,onChange:y,value:u,children:Oe(n)})}),r.map(l=>(0,e.jsx)(T.N,{children:(0,e.jsx)(U.J,{disabled:s.includes(l),"aria-label":l,name:l,value:c.includes(l),onValueChange:_=>o({target:{name:l,value:_}})})},l)),r.length<d&&(0,e.jsx)(T.N,{colSpan:d-r.length})]})},Oe=s=>s.replace(/-/g," ").split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()).join(" "),H={Root:xe,Headers:ve,Body:Pe,Row:re},De=()=>(0,e.jsxs)(H.Root,{children:[(0,e.jsx)(H.Headers,{}),(0,e.jsx)(H.Body,{})]}),Ae=()=>{const{formatMessage:s}=(0,I.A)(),{values:n,errors:r}=(0,P.j7)();return(0,e.jsxs)(p.s,{direction:"column",alignItems:"stretch",gap:1,children:[(0,e.jsx)(E.d,{children:s({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})}),(0,e.jsx)(C.a,{padding:8,background:"neutral100",hasRadius:!0,children:(0,e.jsx)(P.ED,{validateOnChange:!1,name:"headers",render:({push:c,remove:o})=>(0,e.jsxs)(a.x,{gap:4,children:[n.headers.map((g,i)=>{const m=r.headers?.[i],x=typeof m=="object"?m.key:void 0,u=typeof m=="object"?m.value:void 0;return(0,e.jsxs)(f.Fragment,{children:[(0,e.jsx)(h.E,{col:6,children:(0,e.jsx)(P.D0,{as:Ce,name:`headers.${i}.key`,"aria-label":`row ${i+1} key`,label:s({id:"Settings.webhooks.key",defaultMessage:"Key"}),error:x})}),(0,e.jsx)(h.E,{col:6,children:(0,e.jsxs)(p.s,{alignItems:"flex-end",children:[(0,e.jsx)(C.a,{style:{flex:1},children:(0,e.jsx)(P.D0,{as:z.k,name:`headers.${i}.value`,"aria-label":`row ${i+1} value`,label:s({id:"Settings.webhooks.value",defaultMessage:"Value"}),error:u})}),(0,e.jsx)(p.s,{paddingLeft:2,style:{alignSelf:"center"},paddingTop:u?0:5,children:(0,e.jsx)(W.yX,{disabled:n.headers.length===1,onClick:()=>o(i),label:s({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:i+1})})})]})})]},`${i}.${g.key}`)}),(0,e.jsx)(h.E,{col:12,children:(0,e.jsx)(de.Q,{type:"button",onClick:()=>{c({key:"",value:""})},startIcon:(0,e.jsx)(me.A,{}),children:s({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"})})})]})})})]})},Ce=({name:s,onChange:n,value:r,...c})=>{const{values:{headers:o}}=(0,P.j7)(),[g,i]=f.useState([...ae]);f.useEffect(()=>{const u=ae.filter(y=>!o?.some(d=>d.key!==r&&d.key===y));i(u)},[o,r]);const m=u=>{n({target:{name:s,value:u}})},x=u=>{i(y=>[...y,u]),m(u)};return(0,e.jsx)(K.nP,{...c,onClear:()=>m(""),onChange:m,onCreateOption:x,placeholder:"",value:r,children:g.map(u=>(0,e.jsx)(v.j,{value:u,children:u},u))})},ae=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],Te=({isPending:s,onCancel:n,response:r})=>{const{statusCode:c,message:o}=r??{},{formatMessage:g}=(0,I.A)();return(0,e.jsx)(C.a,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0,children:(0,e.jsxs)(a.x,{gap:4,style:{alignItems:"center"},children:[(0,e.jsx)(h.E,{col:3,children:(0,e.jsx)(D.o,{children:g({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"})})}),(0,e.jsx)(h.E,{col:3,children:(0,e.jsx)(We,{isPending:s,statusCode:c})}),(0,e.jsx)(h.E,{col:6,children:s?(0,e.jsx)(p.s,{justifyContent:"flex-end",children:(0,e.jsx)("button",{onClick:n,type:"button",children:(0,e.jsxs)(p.s,{gap:2,alignItems:"center",children:[(0,e.jsx)(D.o,{textColor:"neutral400",children:g({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})}),(0,e.jsx)(N,{as:te.A,color:"neutral400"})]})})}):(0,e.jsx)(Ie,{statusCode:c,message:o})})]})})},N=X.Ay.svg(({theme:s,color:n})=>`
  width: ${12/16}rem;
  height: ${12/16}rem;


  ${n?(0,X.AH)`
          path {
            fill: ${s.colors[n]};
          }
        `:""}
`),We=({isPending:s,statusCode:n})=>{const{formatMessage:r}=(0,I.A)();return s||!n?(0,e.jsxs)(p.s,{gap:2,alignItems:"center",children:[(0,e.jsx)(N,{as:_e.A}),(0,e.jsx)(D.o,{children:r({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"})})]}):n>=200&&n<300?(0,e.jsxs)(p.s,{gap:2,alignItems:"center",children:[(0,e.jsx)(N,{as:se.A,color:"success700"}),(0,e.jsx)(D.o,{children:r({id:"Settings.webhooks.trigger.success",defaultMessage:"success"})})]}):n>=300?(0,e.jsxs)(p.s,{gap:2,alignItems:"center",children:[(0,e.jsx)(N,{as:te.A,color:"danger700"}),(0,e.jsxs)(D.o,{children:[r({id:"Settings.error",defaultMessage:"error"})," ",n]})]}):null},Ie=({statusCode:s,message:n})=>{const{formatMessage:r}=(0,I.A)();return s?s>=200&&s<300?(0,e.jsx)(p.s,{justifyContent:"flex-end",children:(0,e.jsx)(D.o,{textColor:"neutral600",ellipsis:!0,children:r({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"})})}):s>=300?(0,e.jsx)(p.s,{justifyContent:"flex-end",children:(0,e.jsx)(p.s,{maxWidth:(0,W.a8)(250),justifyContent:"flex-end",title:n,children:(0,e.jsx)(D.o,{ellipsis:!0,textColor:"neutral600",children:n})})}):null:null},Re=({handleSubmit:s,triggerWebhook:n,isCreating:r,isTriggering:c,triggerResponse:o,data:g})=>{const{formatMessage:i}=(0,I.A)(),[m,x]=f.useState(!1),u=(0,$.p)(De,async()=>(await t.e(6397).then(t.bind(t,16397))).EventsTableEE),y=l=>Object.keys(l).length?Object.entries(l).map(([_,R])=>({key:_,value:R})):[{key:"",value:""}],d=(0,P.Wx)({initialValues:{name:g?.name||"",url:g?.url||"",headers:y(g?.headers||{}),events:g?.events||[]},async onSubmit(l,_){await s(l,_),_.resetForm({values:l})},validationSchema:Le({formatMessage:i}),validateOnChange:!1,validateOnBlur:!1});return u?(0,e.jsx)(P.QI,{value:d,children:(0,e.jsxs)(W.lV,{children:[(0,e.jsx)(b.Q,{primaryAction:(0,e.jsxs)(p.s,{gap:2,children:[(0,e.jsx)(k.$,{onClick:()=>{n(),x(!0)},variant:"tertiary",startIcon:(0,e.jsx)(Ee.A,{}),disabled:r||c,size:"L",children:i({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})}),(0,e.jsx)(k.$,{startIcon:(0,e.jsx)(se.A,{}),type:"submit",size:"L",disabled:!d.dirty,loading:d.isSubmitting,children:i({id:"global.save",defaultMessage:"Save"})})]}),title:r?i({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):g?.name,navigationAction:(0,e.jsx)(he.N,{as:ce.k2,startIcon:(0,e.jsx)(ue.A,{}),to:"/settings/webhooks",children:i({id:"global.back",defaultMessage:"Back"})})}),(0,e.jsx)(M.s,{children:(0,e.jsxs)(p.s,{direction:"column",alignItems:"stretch",gap:4,children:[m&&(0,e.jsx)(Te,{isPending:c,response:o,onCancel:()=>x(!1)}),(0,e.jsx)(C.a,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0,children:(0,e.jsxs)(p.s,{direction:"column",alignItems:"stretch",gap:6,children:[(0,e.jsxs)(a.x,{gap:6,children:[(0,e.jsx)(h.E,{col:6,children:(0,e.jsx)(P.D0,{as:z.k,name:"name",error:d.errors.name,label:i({id:"global.name",defaultMessage:"Name"}),required:!0})}),(0,e.jsx)(h.E,{col:12,children:(0,e.jsx)(P.D0,{as:z.k,name:"url",error:d.errors.url,label:i({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),required:!0})})]}),(0,e.jsx)(Ae,{}),(0,e.jsx)(u,{})]})})]})})]})}):null},ke=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,Se=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,Le=({formatMessage:s})=>A.Ik().shape({name:A.Yj().required(s({id:"Settings.webhooks.validation.name.required",defaultMessage:"Name is required"})).matches(ke,s({id:"Settings.webhooks.validation.name.regex",defaultMessage:"The name must start with a letter and only contain letters, numbers, spaces and underscores"})),url:A.Yj().required(s({id:"Settings.webhooks.validation.url.required",defaultMessage:"Url is required"})).matches(Se,s({id:"Settings.webhooks.validation.url.regex",defaultMessage:"The value must be a valid Url"})),headers:A.RZ(n=>{const r=A.YO();if(n.length===1){const{key:c,value:o}=n[0];if(!c&&!o)return r}return r.of(A.Ik().shape({key:A.Yj().required(s({id:"Settings.webhooks.validation.key",defaultMessage:"Key is required"})),value:A.Yj().required(s({id:"Settings.webhooks.validation.value",defaultMessage:"Value is required"}))}))}),events:A.YO()}),oe=s=>({...s,headers:s.headers.reduce((n,{key:r,value:c})=>(r!==""&&(n[r]=c),n),{})}),Y=()=>{const n=(0,q.W5)("/settings/webhooks/:id")?.params.id,r=n==="create",{replace:c}=(0,q.W6)(),o=(0,W.hN)(),{_unstableFormatAPIError:g,_unstableFormatValidationErrors:i}=(0,W.wq)(),m=f.useCallback(g,[]),{isLoading:x}=(0,ee.u)(),[u,y]=f.useState(!1),[d,l]=f.useState(),{isLoading:_,webhooks:R,error:Q,createWebhook:Be,updateWebhook:Ke,triggerWebhook:we}=(0,fe.u)({id:n},{skip:r});f.useEffect(()=>{Q&&o({type:"warning",message:m(Q)})},[Q,o,m]);const $e=async()=>{try{y(!0);const S=await we(n);if("error"in S){o({type:"warning",message:g(S.error)});return}l(S.data)}catch{o({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}finally{y(!1)}},He=async(S,ie)=>{try{if(r){const j=await Be(oe(S));if("error"in j){(0,$.x)(j.error)&&j.error.name==="ValidationError"?ie.setErrors(i(j.error)):o({type:"warning",message:g(j.error)});return}o({type:"success",message:{id:"Settings.webhooks.created"}}),c(`/settings/webhooks/${j.data.id}`)}else{const j=await Ke({id:n,...oe(S)});if("error"in j){(0,$.x)(j.error)&&j.error.name==="ValidationError"?ie.setErrors(i(j.error)):o({type:"warning",message:g(j.error)});return}o({type:"success",message:{id:"notification.form.success.fields"}})}}catch{o({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}};if(_||x)return(0,e.jsx)(W.Bl,{});const[Ne]=R??[];return(0,e.jsxs)(O.g,{children:[(0,e.jsx)(W.x7,{name:"Webhooks"}),(0,e.jsx)(Re,{data:Ne,handleSubmit:He,triggerWebhook:$e,isCreating:r,isTriggering:u,triggerResponse:d})]})},Ue=Object.freeze(Object.defineProperty({__proto__:null,EditPage:Y,ProtectedEditPage:()=>{const s=(0,$.j)(ge.s);return(0,e.jsx)(W.kz,{permissions:s.settings?.webhooks.update,children:(0,e.jsx)(Y,{})})}},Symbol.toStringTag,{value:"Module"}))}}]);
