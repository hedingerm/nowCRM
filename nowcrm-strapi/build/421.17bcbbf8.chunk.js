"use strict";(self.webpackChunkstrapi_app=self.webpackChunkstrapi_app||[]).push([[421],{7745:(G,L,s)=>{s.d(L,{u:()=>I});var t=s(16592),C=s(47249),i=s(99532),m=s(9732);const I=(h={},B)=>{const{locale:U}=(0,i.A)(),A=(0,C.QM)(U,{sensitivity:"base"}),{data:e,error:K,isError:T,isLoading:R,refetch:W}=(0,m.z)(h,B);return{roles:t.useMemo(()=>[...e??[]].sort((c,f)=>A.compare(c.name,f.name)),[e,A]),error:K,isError:T,isLoading:R,refetch:W}}},50421:(G,L,s)=>{s.d(L,{ProtectedEditPage:()=>Z});var t=s(15724),C=s(16592),i=s(68574),m=s(33e3),I=s(9704),h=s(78789),B=s(75715),U=s(21087),A=s(75726),e=s(90886),K=s(44466),T=s(73908),R=s(96352),W=s(90087),o=s(47249),c=s(50096),f=s(59652),p=s(99532),j=s(67691),Q=s(39648),x=s(70991),l=s(9732),X=s(7745),Y=s(2411),ns=s(94174),Es=s(52211),is=s(11164),rs=s(43274),ds=s(80265),es=s(4223),ls=s(83670),Ms=s(57036),Ps=s(18337),Ds=s(71430),Os=s(49079),ms=s(61622),hs=s(11338),As=s(24172),Rs=s(54150),gs=s(68216),vs=s(55758),Ls=s(85715),Cs=s(61951),Is=s(50984),Bs=s(97769),Us=s(92082),Ks=s(12958),Ts=s(16439),Ws=s(34215),cs=s(34374),fs=s(81121),js=s(32828),xs=s(45298),us=s(75830),ys=s(36239),ps=s(87295),Ss=s(53377),Ns=s(42605),Fs=s(3342),Vs=s(73518),zs=s(65737),Gs=s(61184),Qs=s(58668),Xs=s(36901),Ys=s(50840),$s=s(13123),Hs=s(7851),Js=s(81330),Zs=s(52432);const $=({disabled:n,role:_,values:D,errors:a,onChange:r,onBlur:g})=>{const{formatMessage:E}=(0,p.A)();return(0,t.jsx)(i.a,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsxs)(e.s,{direction:"column",alignItems:"stretch",gap:4,children:[(0,t.jsxs)(e.s,{justifyContent:"space-between",children:[(0,t.jsxs)(i.a,{children:[(0,t.jsx)(i.a,{children:(0,t.jsx)(R.o,{fontWeight:"bold",children:_?_.name:E({id:"global.details",defaultMessage:"Details"})})}),(0,t.jsx)(i.a,{children:(0,t.jsx)(R.o,{textColor:"neutral500",variant:"pi",children:_?_.description:E({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})})})]}),(0,t.jsx)(m.$,{disabled:!0,variant:"secondary",children:E({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:_.usersCount})})]}),(0,t.jsxs)(I.x,{gap:4,children:[(0,t.jsx)(h.E,{col:6,children:(0,t.jsx)(K.k,{disabled:n,name:"name",error:a.name&&E({id:a.name}),label:E({id:"global.name",defaultMessage:"Name"}),onChange:r,onBlur:g,required:!0,value:D.name||""})}),(0,t.jsx)(h.E,{col:6,children:(0,t.jsx)(T.T,{disabled:n,label:E({id:"global.description",defaultMessage:"Description"}),id:"description",error:a.name&&E({id:a.name}),onChange:r,onBlur:g,children:D.description||""})})]})]})})},H=x.Ik().shape({name:x.Yj().required(o.iW.required),description:x.Yj().optional()}),J=()=>{const n=(0,o.hN)(),{formatMessage:_}=(0,p.A)(),a=(0,j.W5)("/settings/roles/:id")?.params.id,r=C.useRef(null),{lockApp:g,unlockApp:E}=(0,o.MA)(),{trackUsage:b}=(0,o.z1)(),{_unstableFormatAPIError:S,_unstableFormatValidationErrors:N}=(0,o.wq)(),{isLoading:k,data:F}=(0,l.A)({role:a??""}),{roles:w,isLoading:V,refetch:q}=(0,X.u)({id:a},{refetchOnMountOrArgChange:!0}),P=w[0]??{},{data:ss,isLoading:ts}=(0,l.B)({id:a},{skip:!a,refetchOnMountOrArgChange:!0}),[as]=(0,l.G)(),[_s]=(0,l.E)();if(!a)return(0,t.jsx)(j.rd,{to:"/settings/roles"});const os=async(u,v)=>{try{g();const{permissionsToSend:O,didUpdateConditions:y}=r.current?.getPermissions()??{},d=await as({id:a,...u});if("error"in d){(0,l.x)(d.error)&&d.error.name==="ValidationError"?v.setErrors(N(d.error)):n({type:"warning",message:S(d.error)});return}if(P.code!=="strapi-super-admin"&&O){const M=await _s({id:d.data.id,permissions:O});if("error"in M){(0,l.x)(M.error)&&M.error.name==="ValidationError"?v.setErrors(N(M.error)):n({type:"warning",message:S(M.error)});return}y&&b("didUpdateConditions")}r.current?.setFormAfterSubmit(),await q(),n({type:"success",message:{id:"notification.success.saved"}})}catch{n({type:"warning",message:{id:"notification.error"}})}finally{E()}},z=!V&&P.code==="strapi-super-admin";return(0,t.jsxs)(A.g,{children:[(0,t.jsx)(o.x7,{name:"Roles"}),(0,t.jsx)(f.l1,{enableReinitialize:!0,initialValues:{name:P.name??"",description:P.description??""},onSubmit:os,validationSchema:H,validateOnChange:!1,children:({handleSubmit:u,values:v,errors:O,handleChange:y,handleBlur:d,isSubmitting:M})=>(0,t.jsxs)("form",{onSubmit:u,children:[(0,t.jsx)(U.Q,{primaryAction:(0,t.jsx)(e.s,{gap:2,children:(0,t.jsx)(m.$,{type:"submit",disabled:P.code==="strapi-super-admin",loading:M,size:"L",children:_({id:"global.save",defaultMessage:"Save"})})}),title:_({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:_({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:(0,t.jsx)(W.N,{as:Q.k2,startIcon:(0,t.jsx)(c.A,{}),to:"/settings/roles",children:_({id:"global.back",defaultMessage:"Back"})})}),(0,t.jsx)(B.s,{children:(0,t.jsxs)(e.s,{direction:"column",alignItems:"stretch",gap:6,children:[(0,t.jsx)($,{disabled:z,errors:O,values:v,onChange:y,onBlur:d,role:P}),!k&&!V&&!ts&&F?(0,t.jsx)(i.a,{shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)(Y.P,{isFormDisabled:z,permissions:ss,ref:r,layout:F})}):(0,t.jsx)(i.a,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)(o.Bl,{})})]})})]})})]})},Z=()=>{const n=(0,l.j)(r=>r.admin_app.permissions.settings?.roles),{isLoading:_,allowedActions:{canRead:D,canUpdate:a}}=(0,o.ec)(n);return _?(0,t.jsx)(o.Bl,{}):!D&&!a?(0,t.jsx)(j.rd,{to:"/"}):(0,t.jsx)(J,{})}}}]);
