"use strict";(self.webpackChunkstrapi_app=self.webpackChunkstrapi_app||[]).push([[5318],{7745:(x,D,s)=>{s.d(D,{u:()=>L});var t=s(16592),g=s(47249),R=s(99532),i=s(9732);const L=(h={},m)=>{const{locale:A}=(0,R.A)(),O=(0,g.QM)(A,{sensitivity:"base"}),{data:d,error:v,isError:C,isLoading:c,refetch:I}=(0,i.z)(h,m);return{roles:t.useMemo(()=>[...d??[]].sort((W,B)=>O.compare(W.name,B.name)),[d,O]),error:v,isError:C,isLoading:c,refetch:I}}},25318:(x,D,s)=>{s.d(D,{ProtectedSSO:()=>F});var t=s(15724),g=s(33e3),R=s(9704),i=s(78789),L=s(59748),h=s(75715),m=s(21087),A=s(75726),O=s(90886),d=s(2035),v=s(37772),C=s(75063),c=s(51738),I=s(96352),o=s(47249),W=s(25164),B=s(59652),j=s(99532),r=s(70991),M=s(9732),y=s(7745),q=s(94174),ss=s(52211),ts=s(11164),as=s(43274),os=s(80265),_s=s(4223),ns=s(16592),ls=s(83670),es=s(57036),Es=s(18337),is=s(71430),ds=s(49079),rs=s(61622),Ms=s(11338),Os=s(24172),Ps=s(54150),Ds=s(68216),gs=s(55758),Rs=s(85715),Ls=s(61951),hs=s(50984),ms=s(97769),As=s(92082),vs=s(12958),Cs=s(16439),cs=s(34215),Is=s(34374),Ws=s(81121),Bs=s(32828),Ks=s(45298),Ts=s(75830),Us=s(36239),fs=s(87295),us=s(53377),xs=s(42605),js=s(3342),ys=s(73518),Ss=s(65737),ps=s(61184),Fs=s(58668),Ns=s(36901),Vs=s(50840),zs=s(13123),Xs=s(7851);const S=r.Ik().shape({autoRegister:r.lc().required(o.iW.required),defaultRole:r.gl().when("autoRegister",(a,_)=>a?_.required(o.iW.required):_.nullable()),ssoLockedRoles:r.YO().nullable().of(r.gl().when("ssoLockedRoles",(a,_)=>a?_.required(o.iW.required):_.nullable()))}),p=()=>{(0,o.L4)();const{formatMessage:a}=(0,j.A)(),_=(0,M.j)(e=>e.admin_app.permissions),{lockApp:N,unlockApp:V}=(0,o.MA)(),K=(0,o.hN)(),{_unstableFormatAPIError:z,_unstableFormatValidationErrors:X}=(0,o.wq)(),{isLoading:G,data:Q}=(0,M.W)(),[Y,{isLoading:$}]=(0,M.X)(),{isLoading:H,allowedActions:{canUpdate:T,canReadRoles:J}}=(0,o.ec)({..._.settings?.sso,readRoles:_.settings?.roles.read??[]}),{roles:f,isLoading:Z}=(0,y.u)(void 0,{skip:!J}),b=async(e,P)=>{N();try{const n=await Y(e);if("error"in n){(0,M.x)(n.error)&&n.error.name==="ValidationError"?P.setErrors(X(n.error)):K({type:"warning",message:z(n.error)});return}K({type:"success",message:{id:"notification.success.saved"}})}catch{K({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred, please try again."}})}finally{V()}},u=Z||H||G;return(0,t.jsxs)(L.P,{children:[(0,t.jsx)(o.x7,{name:"SSO"}),(0,t.jsx)(A.g,{"aria-busy":$||u,tabIndex:-1,children:(0,t.jsx)(B.l1,{onSubmit:b,initialValues:Q||{autoRegister:!1,defaultRole:null,ssoLockedRoles:null},validationSchema:S,validateOnChange:!1,enableReinitialize:!0,children:({handleChange:e,isSubmitting:P,values:n,setFieldValue:k,dirty:w,errors:E})=>(0,t.jsxs)(o.lV,{children:[(0,t.jsx)(m.Q,{primaryAction:(0,t.jsx)(g.$,{disabled:!w,loading:P,startIcon:(0,t.jsx)(W.A,{}),type:"submit",size:"L",children:a({id:"global.save",defaultMessage:"Save"})}),title:a({id:"Settings.sso.title",defaultMessage:"Single Sign-On"}),subtitle:a({id:"Settings.sso.description",defaultMessage:"Configure the settings for the Single Sign-On feature."})}),(0,t.jsx)(h.s,{children:P||u?(0,t.jsx)(o.Bl,{}):(0,t.jsxs)(O.s,{direction:"column",alignItems:"stretch",gap:4,background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:[(0,t.jsx)(I.o,{variant:"delta",as:"h2",children:a({id:"global.settings",defaultMessage:"Settings"})}),(0,t.jsxs)(R.x,{gap:4,children:[(0,t.jsx)(i.E,{col:6,s:12,children:(0,t.jsx)(c.l,{disabled:!T,checked:n.autoRegister,hint:a({id:"Settings.sso.form.registration.description",defaultMessage:"Create new user on SSO login if no account exists"}),label:a({id:"Settings.sso.form.registration.label",defaultMessage:"Auto-registration"}),name:"autoRegister",offLabel:a({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:a({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:e})}),(0,t.jsx)(i.E,{col:6,s:12,children:(0,t.jsx)(v.l,{disabled:!T,hint:a({id:"Settings.sso.form.defaultRole.description",defaultMessage:"It will attach the new authenticated user to the selected role"}),error:E.defaultRole?a({id:E.defaultRole,defaultMessage:E.defaultRole}):"",label:a({id:"Settings.sso.form.defaultRole.label",defaultMessage:"Default role"}),name:"defaultRole",onChange:l=>e({target:{name:"defaultRole",value:l}}),placeholder:a({id:"components.InputSelect.option.placeholder",defaultMessage:"Choose here"}),value:n.defaultRole,children:f.map(({id:l,name:U})=>(0,t.jsx)(C.c,{value:l.toString(),children:U},l))})}),(0,t.jsx)(i.E,{col:6,s:12,children:(0,t.jsx)(d.KF,{disabled:!T,hint:a({id:"Settings.sso.form.localAuthenticationLock.description",defaultMessage:"Select the roles for which you want to disable the local authentication"}),error:E.ssoLockedRoles?a({id:E.ssoLockedRoles,defaultMessage:E.ssoLockedRoles}):"",label:a({id:"Settings.sso.form.localAuthenticationLock.label",defaultMessage:"Local authentication lock-out"}),name:"ssoLockedRoles",onChange:l=>e({target:{value:l,name:"ssoLockedRoles"}}),placeholder:a({id:"components.InputSelect.option.placeholder",defaultMessage:"Choose here"}),onClear:()=>k("ssoLockedRoles",[]),value:n.ssoLockedRoles||[],withTags:!0,children:f.map(({id:l,name:U})=>(0,t.jsx)(d.fe,{value:l.toString(),children:U},l))})})]})]})})]})})})]})},F=()=>{const a=(0,M.j)(_=>_.admin_app.permissions.settings?.sso?.main);return(0,t.jsx)(o.kz,{permissions:a,children:(0,t.jsx)(p,{})})}}}]);
